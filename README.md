# Trivy UI Dashboard

A web-based UI for visualizing and managing Trivy vulnerability scan results in Kubernetes clusters.

## Overview
Trivy UI provides a centralized dashboard for viewing vulnerability reports generated by the Trivy Operator in Kubernetes environments. It offers an intuitive interface to browse, search, and analyze security vulnerabilities detected in your container images.

## Screenshots

### Dashboard Overview
![Dashboard Overview](./trivy-dashboard/public/trivy-dashboard.png)
*Main dashboard showing vulnerability statistics and summary*

### Report Details
![Report Details](./trivy-dashboard/public/report-details.png)
*In-depth view of individual vulnerability reports*

---

## Quick Start with Docker Image

```shell
docker pull locustbaby/trivy-ui:v0.0.3

docker run -d \
  -v /path/to/your/kubeconfigs:/kubeconfigs \
  -e KUBECONFIG_DIR=/kubeconfigs \
  -p 8080:8080 \
  locustbaby/trivy-ui:v0.0.3
```
- Replace `/path/to/your/kubeconfigs` with the directory containing your kubeconfig files (one per cluster).
- Access the dashboard at http://localhost:8080

---

## Run in Kubernetes

### Using Helm Chart (Recommended)

```bash
# Install directly from Docker Hub OCI registry
helm install my-trivy-ui oci://registry-1.docker.io/locustbaby/trivy-ui

# Or from GitHub Pages
helm repo add trivy-ui https://locustbaby.github.io/trivy-ui/
helm repo update
helm install my-trivy-ui trivy-ui/trivy-ui

# Or from local chart
git clone https://github.com/locustbaby/trivy-ui.git
cd trivy-ui/charts/trivy-ui
helm install my-trivy-ui .
```

### Configure kubeconfigs for multi-cluster support

```bash
kubectl create secret generic kubeconfigs \
  --from-file=cluster1=/path/to/cluster1-kubeconfig \
  --from-file=cluster2=/path/to/cluster2-kubeconfig
```

### Customize the deployment

```bash
helm install my-trivy-ui oci://registry-1.docker.io/locustbaby/trivy-ui \
  --set ingress.enabled=true \
  --set ingress.hosts[0].host=trivy-ui.example.com
```

For detailed Helm chart documentation, see [charts/trivy-ui/README.md](charts/trivy-ui/README.md).

---

## Features
- **Multi-Cluster Support**: View reports from multiple Kubernetes clusters via kubeconfig directory
- **All Trivy CRD Types**: Auto-discovers all Trivy Operator CRDs (VulnerabilityReport, ConfigAuditReport, SbomReport, ExposedSecretReport, RbacAssessmentReport, InfraAssessmentReport, and their cluster-scoped variants)
- **Server-Side Pagination**: Efficient handling of large clusters with hundreds of reports
- **Search & Filter**: Filter by cluster, namespace, and search by report name
- **Detail View**: Full vulnerability/check details fetched on-demand
- **Disk-Persistent Cache**: Fast startup with cached data, background K8s sync
- **Real-time Updates**: Kubernetes informer-based watch for live report changes
- **Memory Optimized**: SetTransform strips large fields from informer store, detail data fetched on-demand
- **Responsive Design**: Works on desktop and mobile

## Architecture

- **Frontend**: React 19 + TypeScript + Vite + Tailwind CSS
- **Backend**: Go with Kubernetes dynamic client, informer-based caching

```
trivy-ui/
├── go-server/         # Go backend
│   ├── api/           # REST handlers, cache, cluster client
│   ├── config/        # CRD registry, app config
│   ├── kubernetes/    # K8s client, informer with SetTransform
│   └── main.go        # Entry point
├── trivy-dashboard/   # React frontend
│   └── src/
│       ├── api/       # API client
│       ├── components/# UI components
│       └── pages/     # Route pages
├── charts/            # Helm chart
│   └── trivy-ui/
└── Dockerfile         # Multi-stage build
```

### Data Flow
1. Backend discovers Trivy Operator CRDs via K8s API
2. Informers watch all report types with SetTransform (stores only summary data in memory)
3. List API serves paginated results from in-memory cache
4. Detail API fetches full report from K8s on-demand, caches with 5-10min TTL
5. Disk cache enables fast pod restarts without re-listing all resources

## Prerequisites
- Go 1.25+
- Node.js 23+
- Access to one or more Kubernetes clusters with Trivy Operator installed

## Development Setup

```shell
# Terminal 1: Backend
cd go-server && go run main.go

# Terminal 2: Frontend (proxies API to localhost:8080)
cd trivy-dashboard && npm install && npm run dev
```

Access the frontend dev server at http://localhost:5173

## Configuration

### Environment Variables

| Variable         | Description                           | Default              |
|------------------|---------------------------------------|----------------------|
| `PORT`           | HTTP port                             | `8080`               |
| `DEBUG`          | Enable debug logging                  | `false`              |
| `STATIC_PATH`    | Path to frontend assets               | `trivy-dashboard/dist` |
| `KUBECONFIG_DIR` | Directory containing kubeconfig files | `/kubeconfigs`       |
| `DATA_PATH`      | Directory for cache persistence       | `/cache`             |

## API Reference

### V1 Endpoints

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/api/v1/type` | List all discovered report types |
| `GET` | `/api/v1/type/{type}` | List reports by type (paginated) |
| `GET` | `/api/v1/type/{type}/{name}` | Get full report details |
| `GET` | `/api/clusters` | List all clusters |
| `GET` | `/api/clusters/{cluster}/namespaces` | List namespaces |
| `GET` | `/api/cache/stats` | Cache statistics |
| `GET` | `/healthz` | Health check |
| `GET` | `/readyz` | Readiness check |

### Query Parameters for list endpoint

| Parameter | Description | Example |
|-----------|-------------|---------|
| `cluster` | Filter by cluster | `?cluster=prod` |
| `namespace` | Filter by namespace (comma-separated) | `?namespace=default,kube-system` |
| `page` | Page number | `?page=2` |
| `pageSize` | Items per page (max 200) | `?pageSize=50` |

## License

MIT
